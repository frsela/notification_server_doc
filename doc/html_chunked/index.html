<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Notification Server</title><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Notification Server"><link rel="next" href="ch01.html" title="Chapter 1. Introduction"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Notification Server</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch01.html">Next</a></td></tr></table><hr></div><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="push_notification_server_architecture"></a>Notification Server</h1></div><div><h2 class="subtitle">Architecture</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Fernando</span> <span class="surname">Rodriguez Sela</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Guillermo</span> <span class="surname">Lopez Leal</span></h3></div></div></div><div><p class="copyright">Copyright © 2012 Telefonica Digital (PDI), All rights reserved.</p></div><div><div class="revhistory"><table style="border-style:solid; width:100%;" summary="Revision History"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.0</td><td align="left">November 2012</td><td align="left">FRS</td></tr><tr><td align="left" colspan="3">First Edition</td></tr><tr><td align="left">Revision 1.1</td><td align="left">March 2013</td><td align="left">FRS</td></tr><tr><td align="left" colspan="3">Simple API</td></tr></table></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="ch01.html">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="ch01.html#idp38304">State of the art</a></span></dt><dd><dl><dt><span class="section"><a href="ch01.html#idp41232">Current Internet solutions issues</a></span></dt></dl></dd><dt><span class="section"><a href="ch01s02.html">Service Description</a></span></dt><dt><span class="section"><a href="ch01s03.html">Adventages for developers</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch02.html">2. Mobile network issues with current PUSH platforms</a></span></dt><dd><dl><dt><span class="section"><a href="ch02.html#idp92800">Mobile networks in a Private or Public LAN</a></span></dt><dt><span class="section"><a href="ch02s02.html">Mobile Network. Circuit domain states</a></span></dt><dt><span class="section"><a href="ch02s03.html">Mobile Network. Package domain states</a></span></dt><dt><span class="section"><a href="ch02s04.html">Mobile Network. States relation</a></span></dt><dt><span class="section"><a href="ch02s05.html">Mobile Network. Signalling storms</a></span></dt><dt><span class="section"><a href="ch02s06.html">Mobile Network. Battery comsuption</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch03.html">3. Notification server API</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#api_wa_ua">API between WebApp and the User Agent</a></span></dt><dt><span class="section"><a href="ch03s02.html">API between the User Agent and the Notification Server</a></span></dt><dt><span class="section"><a href="ch03s03.html">API between the Application Server and the Notification Server</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s03.html#api_as_ns_simplepush">Simple PUSH API</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s04.html">API between the WA and the AS</a></span></dt><dt><span class="section"><a href="ch03s05.html">Tokens</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s05.html#idp317552">channelID</a></span></dt><dt><span class="section"><a href="ch03s05.html#idp323792">UAID</a></span></dt><dt><span class="section"><a href="ch03s05.html#idp325616">endpointURL</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s06.html">WakeUp</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch04.html">4. Log traces</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#idp74304">NOTIFY level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#idp158768"> ID 1001 - datastore::removeMessage --&gt; Message removed from MongoDB ::messageId</a></span></dt><dt><span class="section"><a href="ch04.html#idp160016"> ID 1002 - datastore::ackMessage --&gt; Message ACKed</a></span></dt><dt><span class="section"><a href="ch04.html#idp161168"> ID 1101 - appToken=::appToken -- version=::version</a></span></dt><dt><span class="section"><a href="ch04.html#idp162448"> ID 1102 - Storing message for the '::apptoken' apptoken. Internal Id: ::id</a></span></dt><dt><span class="section"><a href="ch04.html#idp163680"> ID 1203 - MSG_mon::onNodeData --&gt; Notify into the messages queue of node ::serverId # ::messageId</a></span></dt><dt><span class="section"><a href="ch04.html#idp164944"> ID 1301 - Message with id ::messageId sent to ::uaid</a></span></dt><dt><span class="section"><a href="ch04.html#idp166160"> ID 1401 - Notifying node: ::uaid to ::wakeupip:::wakeupport on network ::mcc-::mnc and using protocol ::protocol</a></span></dt><dt><span class="section"><a href="ch04.html#idp167504"> ID 1501 - NS_WakeUp::onHTTPMessage --&gt; Received request for ::url</a></span></dt><dt><span class="section"><a href="ch04.html#idp168736"> ID 1502 - WakeUp TCP packet to ::ip:::port - FAILED</a></span></dt><dt><span class="section"><a href="ch04.html#idp169952"> ID 1503 - WakeUp TCP packet succesfully sent to ::ip:::port</a></span></dt><dt><span class="section"><a href="ch04.html#idp171168"> ID 1504 - WakeUp Datagram sent to ::ip:::port</a></span></dt></dl></dd><dt><span class="section"><a href="ch04s02.html">ERROR level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04s02.html#idp173088"> ID 2000 - ::class::::method --&gt; ::extra, FIX YOUR BACKEND</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp174304"> ID 2001 - datastore::::method --&gt; There was a problem opening the nodes collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp175552"> ID 2002 - datastore::::method --&gt; there was a problem opening the apps collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp176800"> ID 2003 - datastore::::method --&gt; There was a problem opening the operators collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp178064"> ID 2004 - datastore::::method --&gt; There was a problem opening the messages collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp179328"> ID 2005 - datastore::registerNode --&gt; Error inserting/updating node into MongoDB -- ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp180576"> ID 2006 - datastore::registerApplication --&gt; Error inserting application into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp181824"> ID 2007 - dataStore::::method --&gt; Error inserting message to node: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp183056"> ID 2008 - dataStore::unregisterNode --&gt; There was a problem removing the node: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp184304"> ID 2009 - datastore::flushDb --&gt; There was a problem removing the ::collection collection: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp185568"> ID 200a - dataStore::removeMessage --&gt; Error removing message: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp186800"> ID 200b - datastore::::method --&gt; There was a problem finding the certificate - ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp188048"> ID 200c - datastore::getNodeData --&gt; Error finding node into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp189280"> ID 200d - datastore::getApplicationsForUA --&gt; Error finding applications from MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp190528"> ID 200e - datastore::getApplication --&gt; Error finding application from MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp191776"> ID 200f - datastore::getAllMessagesForUA --&gt; There was a problem finding the message: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp29680"> ID 2010 - dataStore::::method --&gt; Error locating channel for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp30928"> ID 2011 - dataStore::unregisterApplication --&gt; Not enough nodes info to pull from nodes collection :(</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp32192"> ID 2012 - dataStore::newVersion --&gt; Error removing old version for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp33440"> ID 2013 - dataStore::newVersion --&gt; Error setting new version for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp34688"> ID 2014 - dataStore::ackMessage --&gt; Error ACK'ing message into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp331248"> ID 2016 - dataStore::::method --&gt; Some error occured --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp332480"> ID 2017 - msgbroker::queue --&gt; one message broker disconnected!!!</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp333712"> ID 2018 - msgbroker::queue.onerror --&gt; There was an error in one of the connections: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp334960"> ID 2019 - No server provided</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp336112"> ID 201a - Received kill (9 or 15) signal</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp337264"> ID 201b - worker ::pid closed unexpectedly with code ::code</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp338480"> ID 201c - ulimit error: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp339632"> ID 201d - [MobileNetwork] --&gt; error!! ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp340784"> ID 2201 - MSG_mon::onNewMessage --&gt; newMessages queue recieved a bad JSON. Check</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp342032"> ID 2202 - MSG_mon::onNewMessage --&gt; Bad msgType: ::json</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp343248"> ID 2203 - MSG_mon::onApplicationData --&gt; There was an error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp344464"> ID 2301 - getConnector --&gt; Error getting the operator from the DB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp345696"> ID 2302 - dataManager::registerNode --&gt; Error getting connection object</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp346928"> ID 2303 - dataManager::unregisterNode --&gt; There was a problem unregistering the uaid ::uaid</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp348208"> ID 2305 - WS::queue::onNewMessage --&gt; Not enough data!</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp349456"> ID 2307 - WS::onWSMessage::getPendingMessages --&gt; There was an error getting the node</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp350736"> ID 2308 - WS::onWSMessage::getPendingMessages --&gt; No channels for this node.</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp352000"> ID 2401 - Connector UDP: Notify to ::wakeupip not valid with this connector</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp353280"> ID 2402 - UDP::queue::onNewMessage --&gt; Not enough data to find server</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp354608"> ID 2403 - UDP::queue::onNewMessage --&gt; Error getting the operator from the DB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp355952"> ID 2404 - UDP:queue:onNewMessage --&gt; Bad address to notify ::address</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp357280"> ID 2501 - Protocol not supported !</a></span></dt></dl></dd><dt><span class="section"><a href="ch04s03.html">CRITICAL level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04s03.html#idp359408"> ID 3001 - ::class::::method --&gt; Error connecting to MongoDB ! - ::error</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp360736"> ID 3002 - ::class::::method --&gt; MsgBroker DISCONNECTED!!'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp362048"> ID 3003 - ::class::::method --&gt; DataStore DISCONNECTED!!'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp363360"> ID 3004 - 30 seconds has passed and we are not ready, closing'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp364672"> ID 3301 - NS_UA_WS interfaces not configured'</a></span></dt></dl></dd></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>2.1. <a href="ch02s04.html#idp116896">RCC - GMM relation</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>3.1. <a href="ch03s05.html#idp320144">Multiple device messages</a></dt><dt>3.2. <a href="ch03s05.html#idp322336">Message broadcast</a></dt></dl></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch01.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> Chapter 1. Introduction</td></tr></table></div></body></html>
