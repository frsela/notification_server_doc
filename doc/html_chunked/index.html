<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Notification Server</title><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"><link rel="home" href="index.html" title="Notification Server"><link rel="next" href="ch01.html" title="Chapter 1. Introduction"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Notification Server</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch01.html">Next</a></td></tr></table><hr></div><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="push_notification_server_architecture"></a>Notification Server</h1></div><div><h2 class="subtitle">Architecture</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Fernando</span> <span class="surname">Rodriguez Sela</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Guillermo</span> <span class="surname">Lopez Leal</span></h3></div></div></div><div><p class="copyright">Copyright © 2012 Telefonica Digital (PDI), All rights reserved.</p></div><div><div class="revhistory"><table style="border-style:solid; width:100%;" summary="Revision History"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 1.0</td><td align="left">November 2012</td><td align="left">FRS</td></tr><tr><td align="left" colspan="3">First Edition</td></tr><tr><td align="left">Revision 1.1</td><td align="left">March 2013</td><td align="left">FRS</td></tr><tr><td align="left" colspan="3">Simple API</td></tr></table></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="ch01.html">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="ch01.html#idp38912">State of the art</a></span></dt><dd><dl><dt><span class="section"><a href="ch01.html#idp41840">Current Internet solutions issues</a></span></dt></dl></dd><dt><span class="section"><a href="ch01s02.html">Service Description</a></span></dt><dt><span class="section"><a href="ch01s03.html">Adventages for developers</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch02.html">2. Mobile network issues with current PUSH platforms</a></span></dt><dd><dl><dt><span class="section"><a href="ch02.html#idp93344">Mobile networks in a Private or Public LAN</a></span></dt><dt><span class="section"><a href="ch02s02.html">Mobile Network. Circuit domain states</a></span></dt><dt><span class="section"><a href="ch02s03.html">Mobile Network. Package domain states</a></span></dt><dt><span class="section"><a href="ch02s04.html">Mobile Network. States relation</a></span></dt><dt><span class="section"><a href="ch02s05.html">Mobile Network. Signalling storms</a></span></dt><dt><span class="section"><a href="ch02s06.html">Mobile Network. Battery comsuption</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch03.html">3. Notification server API</a></span></dt><dd><dl><dt><span class="section"><a href="ch03.html#api_wa_ua">API between WebApp and the User Agent</a></span></dt><dt><span class="section"><a href="ch03s02.html">API between the User Agent and the Notification Server</a></span></dt><dt><span class="section"><a href="ch03s03.html">API between the Application Server and the Notification Server</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s03.html#api_as_ns_simplepush">Simple PUSH API</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s04.html">API between the WA and the AS</a></span></dt><dt><span class="section"><a href="ch03s05.html">Tokens</a></span></dt><dd><dl><dt><span class="section"><a href="ch03s05.html#idp318288">channelID</a></span></dt><dt><span class="section"><a href="ch03s05.html#idp324528">UAID</a></span></dt><dt><span class="section"><a href="ch03s05.html#idp326352">endpointURL</a></span></dt></dl></dd><dt><span class="section"><a href="ch03s06.html">WakeUp</a></span></dt></dl></dd><dt><span class="chapter"><a href="ch04.html">4. Log traces</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#logtraces_NOTIFY_generated">NOTIFY level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04.html#idp154416"> ID 0x1001 - datastore::removeMessage --&gt; Message removed from MongoDB ::messageId</a></span></dt><dt><span class="section"><a href="ch04.html#idp155712"> ID 0x1002 - datastore::ackMessage --&gt; Message ACKed</a></span></dt><dt><span class="section"><a href="ch04.html#idp156992"> ID 0x1101 - appToken=::appToken -- version=::version</a></span></dt><dt><span class="section"><a href="ch04.html#idp63872"> ID 0x1102 - Storing message for the '::apptoken' apptoken. Internal Id: ::id</a></span></dt><dt><span class="section"><a href="ch04.html#idp65104"> ID 0x1203 - MSG_mon::onNodeData --&gt; Notify into the messages queue of node ::serverId # ::messageId</a></span></dt><dt><span class="section"><a href="ch04.html#idp66368"> ID 0x1301 - Message with id ::messageId sent to ::uaid</a></span></dt><dt><span class="section"><a href="ch04.html#idp67584"> ID 0x1401 - Notifying node: ::uaid to ::wakeupip:::wakeupport on network ::mcc-::mnc and using protocol ::protocol</a></span></dt><dt><span class="section"><a href="ch04.html#idp68928"> ID 0x1501 - NS_WakeUp::onHTTPMessage --&gt; Received request for ::url</a></span></dt><dt><span class="section"><a href="ch04.html#idp70160"> ID 0x1502 - WakeUp TCP packet to ::ip:::port - FAILED</a></span></dt><dt><span class="section"><a href="ch04.html#idp71408"> ID 0x1503 - WakeUp TCP packet succesfully sent to ::ip:::port</a></span></dt><dt><span class="section"><a href="ch04.html#idp72720"> ID 0x1504 - WakeUp Datagram sent to ::ip:::port</a></span></dt></dl></dd><dt><span class="section"><a href="ch04s02.html">ERROR level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04s02.html#idp243744"> ID 0x2000 - ::class::::method --&gt; ::extra, FIX YOUR BACKEND</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp245024"> ID 0x2001 - datastore::::method --&gt; There was a problem opening the nodes collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp246384"> ID 0x2002 - datastore::::method --&gt; there was a problem opening the apps collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp247744"> ID 0x2003 - datastore::::method --&gt; There was a problem opening the operators collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp249104"> ID 0x2004 - datastore::::method --&gt; There was a problem opening the messages collection --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp250464"> ID 0x2005 - datastore::registerNode --&gt; Error inserting/updating node into MongoDB -- ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp82464"> ID 0x2006 - datastore::registerApplication --&gt; Error inserting application into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp83824"> ID 0x2007 - dataStore::::method --&gt; Error inserting message to node: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp85152"> ID 0x2008 - dataStore::unregisterNode --&gt; There was a problem removing the node: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp197280"> ID 0x2009 - datastore::flushDb --&gt; There was a problem removing the ::collection collection: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp78496"> ID 0x200a - dataStore::removeMessage --&gt; Error removing message: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp79824"> ID 0x200b - datastore::::method --&gt; There was a problem finding the certificate - ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp81168"> ID 0x200c - datastore::getNodeData --&gt; Error finding node into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp21504"> ID 0x200d - datastore::getApplicationsForUA --&gt; Error finding applications from MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp22864"> ID 0x200e - datastore::getApplication --&gt; Error finding application from MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp24208"> ID 0x200f - datastore::getAllMessagesForUA --&gt; There was a problem finding the message: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp25568"> ID 0x2010 - dataStore::::method --&gt; Error locating channel for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp26912"> ID 0x2011 - dataStore::unregisterApplication --&gt; Not enough nodes info to pull from nodes collection :(</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp28272"> ID 0x2012 - dataStore::newVersion --&gt; Error removing old version for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp29616"> ID 0x2013 - dataStore::newVersion --&gt; Error setting new version for appToken: ::apptoken</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp343088"> ID 0x2014 - dataStore::ackMessage --&gt; Error ACK'ing message into MongoDB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp344432"> ID 0x2016 - dataStore::::method --&gt; Some error occured --&gt; ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp345760"> ID 0x2017 - msgbroker::queue --&gt; one message broker disconnected!!!</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp347088"> ID 0x2018 - msgbroker::queue.onerror --&gt; There was an error in one of the connections: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp348432"> ID 0x2019 - No server provided</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp349712"> ID 0x201a - Received kill (9 or 15) signal</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp351008"> ID 0x201b - worker ::pid closed unexpectedly with code ::code</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp352320"> ID 0x201c - ulimit error: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp353616"> ID 0x201d - [MobileNetwork] --&gt; error!! ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp354928"> ID 0x2201 - MSG_mon::onNewMessage --&gt; newMessages queue recieved a bad JSON. Check</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp356272"> ID 0x2202 - MSG_mon::onNewMessage --&gt; Bad msgType: ::json</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp357584"> ID 0x2203 - MSG_mon::onApplicationData --&gt; There was an error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp358896"> ID 0x2301 - getConnector --&gt; Error getting the operator from the DB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp360224"> ID 0x2302 - dataManager::registerNode --&gt; Error getting connection object</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp361552"> ID 0x2303 - dataManager::unregisterNode --&gt; There was a problem unregistering the uaid ::uaid</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp362896"> ID 0x2305 - WS::queue::onNewMessage --&gt; Not enough data!</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp364208"> ID 0x2307 - WS::onWSMessage::getPendingMessages --&gt; There was an error getting the node</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp365552"> ID 0x2308 - WS::onWSMessage::getPendingMessages --&gt; No channels for this node.</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp366880"> ID 0x2401 - Connector UDP: Notify to ::wakeupip not valid with this connector</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp368208"> ID 0x2402 - UDP::queue::onNewMessage --&gt; Not enough data to find server</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp369536"> ID 0x2403 - UDP::queue::onNewMessage --&gt; Error getting the operator from the DB: ::error</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp370880"> ID 0x2404 - UDP:queue:onNewMessage --&gt; Bad address to notify ::address</a></span></dt><dt><span class="section"><a href="ch04s02.html#idp372208"> ID 0x2501 - Protocol not supported !</a></span></dt></dl></dd><dt><span class="section"><a href="ch04s03.html">CRITICAL level</a></span></dt><dd><dl><dt><span class="section"><a href="ch04s03.html#idp376112"> ID 0x3001 - ::class::::method --&gt; Error connecting to MongoDB ! - ::error</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp377408"> ID 0x3002 - ::class::::method --&gt; MsgBroker DISCONNECTED!!'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp378720"> ID 0x3003 - ::class::::method --&gt; DataStore DISCONNECTED!!'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp380032"> ID 0x3004 - 30 seconds has passed and we are not ready, closing'</a></span></dt><dt><span class="section"><a href="ch04s03.html#idp381360"> ID 0x3301 - NS_UA_WS interfaces not configured'</a></span></dt></dl></dd></dl></dd><dt><span class="reference"><a href="rn01.html">I. Command reference</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="rn01re01.html">load_mcc_mnc_onmongo.awk</a></span><span class="refpurpose"> &#8212; loads a mobile operator list into the central MongoDB</span></dt><dt><span class="refentrytitle"><a href="rn01re02.html">add_wakeupserver_ip</a></span><span class="refpurpose"> &#8212; links a wakeup server IP and Port to a MCC-MNC pair</span></dt><dt><span class="refentrytitle"><a href="rn01re03.html">empty_mongo</a></span><span class="refpurpose"> &#8212; simple script to clean all MongoDB collections</span></dt><dt><span class="refentrytitle"><a href="rn01re04.html">getloginfo</a></span><span class="refpurpose"> &#8212; shows the detailed log trace description</span></dt></dl></dd></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>2.1. <a href="ch02s04.html#idp117536">RCC - GMM relation</a></dt></dl></div><div class="list-of-examples"><p><b>List of Examples</b></p><dl><dt>3.1. <a href="ch03s05.html#idp320880">Multiple device messages</a></dt><dt>3.2. <a href="ch03s05.html#idp323072">Message broadcast</a></dt></dl></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch01.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> Chapter 1. Introduction</td></tr></table></div></body></html>
